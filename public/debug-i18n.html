<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug I18n</title>
</head>
<body>
    <h1>Debug I18n Page</h1>
    <p>Current language: <span id="current-lang"></span></p>

    <div class="language-selector" style="position: absolute; top: 10px; right: 10px;">
        <select id="language-selector" class="form-control" style="min-width: 100px;">
            <option value="zh-CN">中文</option>
            <option value="en-US">English</option>
            <option value="ja-JP">日本語</option>
        </select>
    </div>

    <h2 data-i18n="gameTitle">数独 Sudoku</h2>
    <button id="test-btn" data-i18n="newGame">新游戏</button>

    <pre id="debug-log"></pre>

    <script type="module">
        import './js/i18n/i18n.js';

        const log = (msg) => {
            document.getElementById('debug-log').textContent += msg + '\n';
            console.log(msg);
        };

        // 等待DOM加载
        await new Promise(resolve => {
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', resolve);
            } else {
                resolve();
            }
        });

        log('Starting i18n debug...');
        log('i18n object: ' + (typeof i18n !== 'undefined' ? 'exists' : 'not found'));

        if (typeof i18n !== 'undefined') {
            log('Current language: ' + i18n.currentLang);
            log('Available translations: ' + Object.keys(i18n.translations).join(', '));

            // 尝试加载翻译
            try {
                await i18n.loadTranslations('en-US');
                log('Loaded en-US translations');
                log('Translation for "gameTitle": ' + i18n.t('gameTitle'));
                log('Translation for "newGame": ' + i18n.t('newGame'));
            } catch (error) {
                log('Error loading translations: ' + error.message);
            }

            // 设置初始值
            document.getElementById('current-lang').textContent = i18n.currentLang;

            // 测试切换语言
            const selector = document.getElementById('language-selector');
            selector.value = i18n.currentLang;

            selector.addEventListener('change', async (e) => {
                const newLang = e.target.value;
                log('Changing language to: ' + newLang);

                try {
                    await i18n.setLanguage(newLang);
                    log('Language changed successfully');
                    log('Current language now: ' + i18n.currentLang);
                    document.getElementById('current-lang').textContent = i18n.currentLang;
                } catch (error) {
                    log('Error changing language: ' + error.message);
                }
            });
        } else {
            log('ERROR: i18n is not defined');
        }
    </script>
</body>
</html>